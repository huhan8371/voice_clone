## 关于 SSML

SSML 是语音合成标记语言（Speech Synthesis Markup Language）的缩写。它是 W3C 的语音接口框架的一部分，通过 SSML，可以对语音合成的效果进行定制化。
注：双向流式 API 目前不支持 SSML

## 关于 Universal SSML

Universal SSML 是 Flute 统一 TTS 前端（Universal FrontEnd，简称 UFE）采用的与具体语种解耦的 SSML 框架，能够方便地为不同语种提供 SSML 能力。

### 说明

如果使用中英混音色，需要注意比较短的英文句子可能被语种识别为中文，部分标签在中文和英文场景下表现不同。例如在中文场景下，如果 Verbatim 内的文本是有效单词则不会按字母读。

### 必读

> 注意
> -   接口传参时，请选择 text_type=ssml
> -   所有文本 需放在  `<speak></speak>`标签之内
> -   不同语种模型可使用的标签不同，请严格按照下表进行请求，否则会系统报错
> -   当前仅支持中文普通话音色 SSML 调用，方言及小语种音色 SSML 调用后续会进行支持
> -   使用 ssml 标签时合成字符不要超过 150（包含标签本身），否则出现 badcase 概率会大大增加

### 支持的标签

| 标签          | 属性                     | 功能                                    | 备注                                                       |
| ------------- | ------------------------ | --------------------------------------- | ---------------------------------------------------------- |
| <speak>       |                          | 根元素。 <br>可设置全局属性。           | 根元素是必需的。 <br>若无该元素，输入文本将不被认为是 SSML |
| <phoneme>     | alphabet="cmu"           | 指定单词发音的音标 <br>（CMU 格式）     |                                                            |
| alphabet="py" | 指定中文词的发音（拼音） |                                         |
| <say-as>      | interpret-as             | 指定解析文本的语义类型 <br>（决定读法） | 例如，20 可以读作 twenty，也可以读作 two o                 |
| <sub>         | alias                    | 文本替换                                | 等价于将其内部文本替换为 alias 属性中的文本                |

## <speak> 根元素

### 描述

<speak>作为 SSML 的根元素出现。不存在该根元素的输入文本不会被认为是 SSML。

### 子元素

任意

### 注意事项

- 根元素即包含了其它全部内容的元素，不应存在与之并列或包含根元素的其它元素。
- 根元素应当只出现一次。

### 实例

> 如无特别说明，实例中的音频均由英语 UFE 前端+DB6 音色 Tacotron 后端生成。

- 正确示范

```XML
<speak>hello world</speak>
```

- 错误示范：多次出现

```XML
<speak>hello <speak>world</speak></speak>
```

> 报错：unrecognized ssml: 1 -- failed to parse child -- failed to parse ssml

- 错误示范：缺少唯一根元素（存在并列的顶级元素）

```XML
<speak>hello</speak> <speak>world</speak>
```

> 目前的行为是仅考虑第一个根元素的内容，暂不报错

- 错误示范：缺少根元素（不被认为是 SSML）

```XML
hello world
```

```XML
hello <break/> world
```

## <phoneme> 指定字词发音（音素）

### 描述

<phoneme>用于手动指定部分字词的发音。通常用于纠正 TTS 为多音字自动生成的不准确发音。

### 属性

| 参数       | 类型     | 功能                       | 取值                                                                               |
| ---------- | -------- | -------------------------- | ---------------------------------------------------------------------------------- |
| `alphabet` | `enum`   | 指定表示发音（音素）的格式 | - 中文<br> - `py`拼音<br>- 英文<br> - `cmu` CMU 音标格式<br> - `ipa`柯林斯美音音标 |
| `ph`       | `string` | 指定发音（音素）           | - 不同的`alphabet`取值对应不同的`ph`表示方法<br> - 参见下文“注意事项”部分          |

### 子元素

纯文本

### 拼音（`py`）

#### 注意事项

- 用于中文前端。
- 使用空格分隔多个拼音。
- 不区分大小写。
- 子元素必须为纯文本，且为一个或多个汉字，不应出现标点符号。
- 声母是可选的。
- 音调包括：
    - 1 - 阴平、2 - 阳平、3 - 上声、4 - 去声
    - 5 - 轻声
    - 6 - 连续两个上声时，第一个上声的音调即为 6（接近 2 - 阳平），参见[三声变调（连上变调）](https://zh.wikipedia.org/zh-hans/%E8%AE%8A%E8%AA%BF)

#### 实例

```XML
<speak>《茜茜公主》是奥地利拍摄的历史题材的德语三部曲电影。</speak>
```

```XML
<speak> 《
    <phoneme alphabet="py" ph="xi1 xi1">茜茜</phoneme>
    公主》是奥地利拍摄的历史题材的德语三部曲电影。
</speak>
```

```XML
<speak>要一起去<phoneme alphabet="py" ph="chi1">吃</phoneme>饭吗</speak>
```

### CMU 音标（`cmu`）

#### 注意事项

- 用于英文前端。
- 使用空格分隔多个音素。
- 不区分大小写。
- CMU 元音音标包含可选的 Stress 标号，如`IY1`、`UW2`。
- 子元素必须为纯文本，且为一个或多个英文单词，不应出现标点符号。

#### 实例

- 正确示范

```XML
<speak>
    <!-- 不区分大小写 -->
    <phoneme alphabet="cmu" ph="w uw1 ch IY1 l Uw n">
    Wu Qilong
    </phoneme>
    and Wu Qilong
</speak>
```

- 错误示范：不应出现标点符号

```XML
<speak>
    <phoneme alphabet="cmu" ph="w uw1 ch IY1 l Uw n">
    Wu, Qilong
    </phoneme>
</speak>
```

> 报错： should align with the word groups

### 柯林斯美音音标（`ipa`）

#### 注意事项

- 用于英文前端。
- 不使用分隔符，连续书写音标。
- 注意只能使用美式音标。
- 子元素必须为纯文本，且为一个或多个英文单词，不应出现标点符号。
- 音标包括：

```Python
"i",      "ɪ",     "ɛ/e",   "æ",      "ɑ/ɑː", "ɔ/ɔ:",      "u/u:",
"ʊ",      "ʌ",     "ə",     "ɜr/ɜːr", "ər",   "aɪ/ai",     "eɪ/ei",
"ɔɪ/ɔi",  "oʊ/ou", "aʊ/au", "ɑr/ɑːr", "ɔr",   "ʊr/ur/ʊər", "ɛr/ɛər",
"ɪr/ɪər", "p",     "b",     "t",      "d",    "k",         "g",
"f",      "v",     "θ",     "ð",      "s",    "z",         "ʃ",
"ʒ",      "tʃ",    "dʒ",    "tr",     "dr",   "ts",        "dz",
"l",      "r",     "m",     "n",      "ŋ",    "w",         "j",
"h",
```

- 重音符和次重音符：

```Python
"ˈ", "ˌ"
```

#### 实例

- 正确示范

```XML
<speak>
    <phoneme alphabet="ipa" ph="wutʃilun">
    Wu Qilong
    </phoneme>
    and Wu Qilong
</speak>
```

## <say-as> 指定字词解析语义（读法）

### 描述

<say-as>用于指定解析文本的语义类型。同一文本内容可能有不同的解读，也就有不同的读法。

### 属性

| 参数           | 类型   | 功能         | 取值                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -------------- | ------ | ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `interpret-as` | `enum` | 指定语义类型 | - 文本正规化支持的类别（取决于各语言前端的 TextNorm 模块的能力）<br> - 英文<br> - `address`  地址<br> - `cardinal`  基数<br> - `date`  日期<br> - `decimal`  小数<br> - `digit`  数字序列<br> - `electronic`网络<br> - `fraction`  分数<br> - `letters`字母序列<br> - `letterss`字母序列复数<br> - `math`  数学<br> - `measure`  度量衡<br> - `money`金钱<br> - `ordinal`  序数<br> - `plain`缩写<br> - `score`  得分范围<br> - `telephone`  电话号码<br> - `time`  时间<br> - `verbatim`  逐字<br> - 中文<br> - `Cardinal`基数<br> - `Cardinal-Liang`基数（2 -> 两）<br> - `Decimal`小数<br> - `Abbr`缩写<br> - `Spell`数字序列<br> - `Spell-Yao`数字序列（1 -> 幺）<br> - `Time`时间<br> - `Time-Duration`时间段<br> - `Date-Y`日期-年<br> - `Date-M`日期-月<br> - `Date-D`日期-日<br> - `Date-YMD`日期-年月（日）<br> - `Date-MDY`日期-月日（年）<br> - `Date-DMY`日期-日月（年）<br> - `Percent`百分数<br> - `Fraction`分数<br> - `Score`比分<br> - `Currency`金钱<br> - `Electronic`网络<br> - `Measure`度量衡<br> - `Telephone`电话<br> - `Ordinal`序数<br> - `Math`数学<br> - `Range`范围<br> - `Letters`字母序列<br> - `Letterss`字母序列复数<br> - `Verbatim`逐字 |

### 子元素

纯文本

### 文本正规化支持的类别

#### 注意事项

- 不区分大小写。
- 子元素必须为纯文本。

#### 实例

- 正确示范

```XML
<speak>12:30 and <say-as interpret-as="score">12:30</say-as></speak>
```

```XML
<speak>12.30 and <say-as interpret-as="date">12.30</say-as></speak>
```

```XML
<speak>
    20
    and <say-as interpret-as="ordinal">20</say-as>
    and <say-as interpret-as="digit">20</say-as>
</speak>
```

```XML
<speak>hello and <say-as interpret-as="verbatim">hello</say-as></speak>
```

- 错误示范：不应出现其它标签

```XML
<speak>
    <say-as interpret-as="digit">
        12 <break time="100ms" /> 34
    </say-as>
</speak>
```

> 报错： can only contain plain text -- failed to parse child -- failed to parse ssml

## <sub> 文本替换

### 描述

<sub>等价于将其内部的文本替换为其 alias 属性中的文本。

### 属性

| 参数    | 类型     | 功能     | 取值 |
| ------- | -------- | -------- | ---- |
| `alias` | `string` | 替换文本 |      |

### 实例

```XML
<speak><sub alias="语音合成标记语言">SSML</sub></speak>
```
